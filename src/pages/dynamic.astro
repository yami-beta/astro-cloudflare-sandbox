---
import Layout from "../layouts/Layout.astro";

// このページはSSR（サーバーサイドレンダリング）で動的に生成されます
export const prerender = false;

// リクエスト時の現在時刻を取得
const currentTime = new Date().toLocaleString("ja-JP", {
  timeZone: "Asia/Tokyo",
  year: "numeric",
  month: "2-digit",
  day: "2-digit",
  hour: "2-digit",
  minute: "2-digit",
  second: "2-digit",
});

// ランダムな数値を生成（リクエストごとに変わることを示すため）
const randomNumber = Math.floor(Math.random() * 1000);

// Cloudflare環境の場合、環境情報を取得
const runtime = Astro.locals.runtime;
const cfInfo = runtime?.cf ? {
  country: runtime.cf.country || "不明",
  city: runtime.cf.city || "不明",
  timezone: runtime.cf.timezone || "不明",
} : null;
---

<Layout>
  <main>
    <nav>
      <a href="/">← トップに戻る</a>
    </nav>
    
    <h1>動的レンダリングページ (SSR)</h1>
    
    <section>
      <h2>このページについて</h2>
      <p>
        このページは<strong>リクエストごとに動的に生成</strong>されます。
        <code>export const prerender = false</code>を設定することで、
        Astroに対してこのページをSSR（サーバーサイドレンダリング）で処理するよう指示しています。
      </p>
    </section>
    
    <section>
      <h2>現在時刻</h2>
      <p class="current-time">
        現在時刻: <time>{currentTime}</time>
      </p>
      <p class="note">
        ※ この時刻はページをリロードするたびに更新されます。
      </p>
    </section>
    
    <section>
      <h2>ランダム値</h2>
      <p class="random-number">
        ランダム値: <span>{randomNumber}</span>
      </p>
      <p class="note">
        ※ この値もリロードするたびに変わります。
      </p>
    </section>
    
    {cfInfo && (
      <section>
        <h2>Cloudflare環境情報</h2>
        <dl>
          <dt>国:</dt>
          <dd>{cfInfo.country}</dd>
          <dt>都市:</dt>
          <dd>{cfInfo.city}</dd>
          <dt>タイムゾーン:</dt>
          <dd>{cfInfo.timezone}</dd>
        </dl>
        <p class="note">
          ※ Cloudflare Workers環境でのみ表示されます。
        </p>
      </section>
    )}
    
    <section>
      <h2>動的レンダリングのメリット</h2>
      <ul>
        <li>リアルタイムデータの表示</li>
        <li>ユーザー固有のコンテンツ配信</li>
        <li>外部APIとの連携</li>
        <li>認証・認可処理</li>
      </ul>
    </section>
    
    <section>
      <h2>使用例</h2>
      <ul>
        <li>ダッシュボード</li>
        <li>ユーザープロフィール</li>
        <li>リアルタイムデータ表示</li>
        <li>検索結果ページ</li>
      </ul>
    </section>
  </main>
</Layout>

<style>
  main {
    max-width: 800px;
    margin: 2rem auto;
    padding: 0 1rem;
  }
  
  nav {
    margin-bottom: 2rem;
  }
  
  nav a {
    color: #4f39fa;
    text-decoration: none;
  }
  
  nav a:hover {
    text-decoration: underline;
  }
  
  h1 {
    color: #333;
    margin-bottom: 1rem;
  }
  
  h2 {
    color: #555;
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  
  section {
    margin-bottom: 2rem;
  }
  
  .current-time, .random-number {
    font-size: 1.2rem;
    padding: 1rem;
    background-color: #e8f5e9;
    border-radius: 8px;
    margin: 1rem 0;
  }
  
  .current-time time, .random-number span {
    font-weight: bold;
    color: #2e7d32;
  }
  
  .note {
    color: #666;
    font-size: 0.9rem;
    font-style: italic;
  }
  
  code {
    background-color: #f5f5f5;
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-family: monospace;
    font-size: 0.9rem;
  }
  
  dl {
    background-color: #f0f4ff;
    padding: 1rem;
    border-radius: 8px;
  }
  
  dt {
    font-weight: bold;
    color: #333;
    display: inline-block;
    width: 120px;
  }
  
  dd {
    display: inline;
    margin: 0;
    color: #666;
  }
  
  ul {
    list-style-position: inside;
    line-height: 1.8;
  }
  
  p {
    line-height: 1.6;
    color: #666;
  }
  
  strong {
    color: #333;
  }
</style>